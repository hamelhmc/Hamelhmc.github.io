---
import type { Knowledge, AboutMe as AboutMeType } from '@/data/model/manfred.interface';
import Card from '@/components/atoms/Card.astro';

import SectionHeader from '@/components/molecules/SectionHeader.astro';
import LanguageItem from '@/components/molecules/LanguageItem.astro';

interface Props {
  knowledge: Knowledge;
  aboutMe: AboutMeType;
  desiredJobDescription?: string;
}

const { knowledge, aboutMe, desiredJobDescription } = Astro.props;

// Soft skills
const softSkills = knowledge.softSkills.map((s) => s.skill.name);

// Languages
const languages = knowledge.languages;

// Interests from interesting facts
const interests = aboutMe.interestingFacts || [];
---

<section id="sobre-mi" class="py-24 scroll-mt-20" aria-labelledby="about-heading">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Section Header -->
    <SectionHeader badge="Sobre MÃ­" title="MÃ¡s allÃ¡ del cÃ³digo" id="about-heading" />

    <!-- Cards Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Soft Skills Card -->
      <Card class="h-full p-8" as="article">
        <span class="text-primary font-semibold text-xs tracking-[0.15em] uppercase mb-6 block">Habilidades Blandas</span>
        <ul class="space-y-4" role="list">
          {
            softSkills.map((skill) => (
              <li class="flex items-center gap-3">
                <div class="w-2 h-2 rounded-full bg-primary" aria-hidden="true" />
                <span class="text-gray-800 dark:text-txt-secondary">{skill}</span>
              </li>
            ))
          }
        </ul>
      </Card>

      <!-- Languages Card -->
      <Card class="h-full p-8" as="article">
        <span class="text-primary font-semibold text-xs tracking-[0.15em] uppercase mb-6 block">Idiomas</span>
        <div class="space-y-4">
          {languages.map((lang) => <LanguageItem name={lang.name} fullName={lang.fullName} level={lang.level} />)}
        </div>
      </Card>

      <!-- Interests Card -->
      <Card class="h-full p-8" as="article">
        <span class="text-primary font-semibold text-xs tracking-[0.15em] uppercase mb-6 block">Intereses</span>
        {
          interests.length > 0 ? (
            <div class="space-y-4">
              {interests.map((item) => (
                <div class="space-y-2">
                  <p class="text-gray-600 dark:text-txt-secondary text-sm leading-relaxed">
                    {item.fact
                      .replace(/\\n/g, ' ')
                      .replace(/ğŸ¡|ğŸ¢|ğŸ’»|ğŸ§|ğŸŸ¡/g, '')
                      .trim()}
                  </p>
                </div>
              ))}
              <div class="flex items-center gap-2 pt-2">
                <div class="w-6 h-6 rounded-full bg-yellow-400" aria-label="Amarillo" />
                <span class="text-sm text-gray-600 dark:text-txt-secondary">Color favorito</span>
              </div>
            </div>
          ) : (
            <p class="text-gray-600 dark:text-txt-secondary text-sm">
              Apasionado del teletrabajo y trabajo hÃ­brido. Desarrollo tanto frontend como backend. Fan de Mac y Linux.
            </p>
          )
        }
      </Card>

      <!-- Desired Job Card (Spans full width on mobile, maybe 2 cols on wide if we had 4 cols, but here we keep grid flow) -->
      <!-- Let's make it span full width of the grid container if we want, or just another card. 
           Given the grid is cols-3, adding a 4th card might look uneven unless we adjust layout.
           Let's place it as a full-width item below the main 3 cards, or modify grid to fit.
           Actually, let's put it as a separate full-width card below the 3 columns.
      -->
    </div>

    {
      desiredJobDescription && (
        <div class="mt-6">
          <Card class="p-8">
            <span class="text-primary font-semibold text-xs tracking-[0.15em] uppercase mb-6 block">Lo que busco</span>
            <div class="prose prose-sm dark:prose-invert max-w-none text-gray-600 dark:text-txt-secondary">
              {desiredJobDescription.split('\n\n').map((p) => (
                <p class="mb-4 last:mb-0 text-pretty">{p}</p>
              ))}
            </div>
          </Card>
        </div>
      )
    }
  </div>
</section>
