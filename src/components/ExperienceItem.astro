---
interface Competence {
  name: string;
  type: string;
}

interface Props {
  title: string;
  company: string;
  description: string;
  competences?: Competence[];
  link?: string;
  date: string;
  isFirst?: boolean;
  isLast?: boolean;
}

const { title, company, description, competences = [], link, date, isFirst = false, isLast = false } = Astro.props;
---

<article class="relative group mb-8 md:mb-12 last:mb-0">
  {/* Mobile Layout */}
  <div class="block lg:hidden">
    {/* Mobile Date Badge */}
    <div class="flex items-center gap-3 mb-3">
      <time
        class="inline-flex items-center px-3 py-1 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-50 dark:bg-primary-900/30 rounded-full"
        datetime={date}>
        {date}
      </time>
    </div>

    {/* Mobile Content Card */}
    <div class="p-5 rounded-2xl bg-white/50 dark:bg-glass border border-gray-200/50 dark:border-glass-border backdrop-blur-xl">
      <div class="space-y-1 mb-3">
        <h3 class="text-lg font-bold text-gray-900 dark:text-txt-primary tracking-tight leading-tight">
          {title}
        </h3>
        <p class="text-sm font-medium text-gray-600 dark:text-txt-secondary">
          {company}
        </p>
      </div>

      <div class="text-gray-600 dark:text-txt-secondary leading-relaxed whitespace-pre-line text-sm mb-4">
        {description}
      </div>

      {
        competences.length > 0 && (
          <div class="pt-3 border-t border-gray-200/50 dark:border-glass-border">
            <div class="flex flex-wrap gap-1.5">
              {competences.map((comp) => (
                <span class="px-2 py-1 text-[10px] font-medium text-primary-700 dark:text-primary-300 bg-primary-50 dark:bg-primary-900/30 border border-primary-200/50 dark:border-primary-700/30 rounded-full">
                  {comp.name}
                </span>
              ))}
            </div>
          </div>
        )
      }
    </div>
  </div>

  {/* Desktop Layout with Timeline */}
  <div class="hidden lg:flex gap-8">
    {/* Timeline column - date */}
    <div class="flex flex-col items-end shrink-0" style="width: 120px;">
      <time class="text-sm font-medium text-gray-500 dark:text-txt-tertiary tabular-nums whitespace-nowrap pt-1" datetime={date}>
        {date}
      </time>
    </div>

    {/* Timeline dot and connector line */}
    <div class="flex flex-col items-center shrink-0 relative">
      {/* Connector line - top half (not for first item) */}
      {!isFirst && <div class="w-0.5 h-6 bg-gradient-to-b from-primary-400 to-primary-500" aria-hidden="true" />}
      {isFirst && <div class="h-6" aria-hidden="true" />}

      {/* The dot */}
      <div class="relative z-10 flex-shrink-0">
        <div
          class="w-4 h-4 rounded-full bg-gradient-to-br from-primary-400 to-primary-600 ring-4 ring-white dark:ring-deep shadow-md shadow-primary-500/30">
          <div class="absolute inset-[3px] rounded-full bg-white dark:bg-deep"></div>
        </div>
      </div>

      {/* Connector line - bottom half (not for last item) */}
      {!isLast && <div class="w-0.5 flex-1 bg-gradient-to-b from-primary-500 to-primary-400/50 min-h-[60px]" aria-hidden="true" />}
    </div>

    {/* Content Card */}
    <div
      class="flex-1 p-8 rounded-2xl bg-white/50 dark:bg-glass border border-gray-200/50 dark:border-glass-border backdrop-blur-xl transition-all duration-300 hover:bg-white/70 dark:hover:bg-glass-strong group-hover:shadow-lg">
      <div class="space-y-2 mb-4">
        <h3
          class="text-2xl font-bold text-gray-900 dark:text-txt-primary tracking-tight leading-tight group-hover:text-primary transition-colors duration-300">
          {title}
        </h3>
        <div class="flex items-center gap-2">
          <div class="w-1.5 h-1.5 rounded-full bg-primary" aria-hidden="true"></div>
          <p class="text-base font-medium text-gray-700 dark:text-txt-secondary">
            {company}
          </p>
        </div>
      </div>

      <div class="prose prose-sm dark:prose-invert max-w-none mb-4">
        <div class="text-gray-600 dark:text-txt-secondary leading-relaxed space-y-2 whitespace-pre-line text-[15px]">
          {description}
        </div>
      </div>

      {
        competences.length > 0 && (
          <div class="pt-4 border-t border-gray-200/50 dark:border-glass-border">
            <div class="flex flex-wrap gap-2">
              {competences.map((comp) => (
                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-primary-700 dark:text-primary-300 bg-primary-50 dark:bg-primary-900/30 border border-primary-200/50 dark:border-primary-700/30 rounded-full transition-all duration-200 hover:bg-primary-100 dark:hover:bg-primary-800/40">
                  {comp.name}
                </span>
              ))}
            </div>
          </div>
        )
      }

      {
        link && (
          <div class="pt-4 mt-4 border-t border-gray-200/50 dark:border-glass-border">
            <a
              href={link}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-2 text-sm font-medium text-primary hover:text-primary-600 transition-colors duration-200">
              <span>Saber m√°s</span>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </a>
          </div>
        )
      }
    </div>
  </div>
</article>

<style>
  article {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  time {
    font-variant-numeric: tabular-nums;
  }
</style>
